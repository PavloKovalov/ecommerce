<?php
$title = $this->translate('Shipping configuration');
$this->headTitle($title);
$this->placeholder('headerContent')->set($title);

$this->headScript()->appendFile($this->websiteUrl.'plugins/shopping/web/js/libs/require.min.js', null, array('data-main' => $this->websiteUrl.'plugins/shopping/web/js/shipping.js'));

?>
<!--[if lte IE 7]><script type="text/javascript" src="<?php echo $this->websiteUrl;?>plugins/shopping/web/css/icon-ie.js"></script><![endif]-->
<link type="text/css" rel="stylesheet" media="screen" href="<?php echo $this->websiteUrl; ?>plugins/shopping/web/css/toaster-icon.css">
<form id="general-config" class="container_12 clearfix" style="min-height: 0">
    <label class="mt5px grid_6 omega" for="config-checkoutShippingTocRequire">
	    <?php echo $this->formCheckbox(
	        'config['.Shopping::SHIPPING_TOC_STATUS.']',
	        null,
	        array('checked' => isset($this->shoppingConfig[Shopping::SHIPPING_TOC_STATUS]) ? $this->shoppingConfig[Shopping::SHIPPING_TOC_STATUS] : false)
	        ); ?>
		<?php echo $this->translate('Require Shipping TOC on checkout. Use label (HTML ok):'); ?>
    </label>
	<div class="grid_6 alpha">
		<?php
		echo $this->formText(
		'config['.Shopping::SHIPPING_TOC_LABEL.']',
		isset($this->shoppingConfig[Shopping::SHIPPING_TOC_LABEL]) ? $this->shoppingConfig[Shopping::SHIPPING_TOC_LABEL] : null,
		array('placeholder' => $this->translate('left empty to use autogenerated label'))
		);
		?>
	</div>
</form>
<div id="shipping-config" class="container_12 clearfix">
	<div id="shippers" class="mt10px mb10px clearfix">
		<ul class="grid_4 omega">
            <li><a href="#markup" data-plugin="markup"><?php echo $this->translate('Markup');?></a></li>
			<li><a href="#pickup" data-plugin="pickup"><?php echo $this->translate('Pickup');?></a></li>
			<li><a href="#freeshipping" data-plugin="freeshipping"><?php echo $this->translate('Free shipping');?></a></li>
		<?php foreach($this->shippingPlugins as $plugin):?>
			<li><a data-plugin="<?php echo $plugin->getName();?>" href="<?php echo $this->url(array('run' => 'config', 'name' => strtolower($plugin->getName())), 'pluginroute');?>"><?php echo $plugin->getName();?></a></li>
		<?php endforeach; ?>
		</ul>
		<div id="pane-container" class="grid_8 alpha omega relative" style="padding: .1em .2em 0;">

            <div id="markup">
                <header><?php echo $this->translate('Shipping markup configuration');?></header>
                <?php $this->markupForm->setAction($this->url(array('run' => 'bundledshipper')));?>
                <form class="clearfix" action="<?php echo $this->markupForm->getAction();?>" method="post" enctype="application/x-www-form-urlencoded">
					<?php echo $this->markupForm->getElement('shipper')->renderViewHelper(); ?>
                    <label class="grid_3 mt5px textright" for="cartamount"><?php echo $this->markupForm->getElement('price')->getLabel();?></label>
					<div class="grid_2 relative">
                        <?php echo $this->markupForm->getElement('modifierSign')->renderViewHelper();?>
                    </div>
                    <div class="grid_2 relative">
						<?php echo $this->markupForm->getElement('price')->renderViewHelper();?>
						<label class="unit-over"><?php //echo $this->config['currency'];?></label>
					</div>
                    <div class="grid_2 relative">
                        <?php echo $this->markupForm->getElement('modifierType')->renderViewHelper();?>
                    </div>
                 </form>
            </div>
			<div id="pickup">
				<label style="display: block;margin: 10px; text-align: justify"><?php echo $this->translate('When this option is checked user will be given the option to pick their stuff up at your store location.'); ?></label>
			</div>
			<div id="freeshipping">
				<header><?php echo $this->translate('Free shipping');?></header>
				<?php $this->freeForm->setAction($this->url(array('run' => 'bundledshipper')));?>
				<form class="clearfix" action="<?php echo $this->freeForm->getAction();?>" method="post" enctype="application/x-www-form-urlencoded">
					<?php echo $this->freeForm->getElement('shipper')->renderViewHelper(); ?>
					<label class="grid_3 mt5px textright" for="cartamount"><?php echo $this->freeForm->getElement('cartamount')->getLabel();?></label>
					<div class="grid_3 relative">
						<?php echo $this->freeForm->getElement('cartamount')->renderViewHelper();?>
						<label class="unit-over"><?php echo $this->config['currency'];?></label>
					</div>
					<label class="grid_2 mt5px textcentered"><?php echo $this->freeForm->getElement('destination')->getLabel();?></label>
					<div class="grid_3">
						<?php echo $this->freeForm->getElement('destination')->renderViewHelper();?>
					</div>
                    <label class="grid_12 mt10px"><?php echo $this->freeForm->getElement('errormessage')->getLabel();?>:</label>
                    <div class="grid_12">
                        <?php echo $this->freeForm->getElement('errormessage')->renderViewHelper();?>
                    </div>
				</form>
			</div>
		</div>
		<div class="grid_12 mt10px">
			<?php echo $this->formSubmit('submit', 'Save');?>
		</div>
	</div>
</div>

<script>
$(function(){
	$('form#general-config :input').on('change', function(){
		$.post($('#website_url').val() + 'plugin/shopping/run/setConfig', $(this).closest('form').serialize()) ;
	});

	$('#shippers').tabs({
		idPrefix: 'shipper-tab',
		panelTemplate: '<div class="clearfix"></div>',
		create: function(event, ui){
            $(this).find('ul.ui-tabs-nav, ul.ui-tabs-nav > li').removeClass('ui-corner-top ui-widget-header')
				.end().find('.ui-tabs-panel').removeClass('ui-corner-bottom');
		}
	});

	$(document).ajaxStart(function(){
		showSpinner();
	}).ajaxStop(function(){
		hideSpinner();
	});
});
</script>