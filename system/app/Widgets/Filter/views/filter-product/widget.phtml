<?php if (!empty($this->tags) || !empty($this->brands) || !empty($this->filters) || !empty($this->priceRange)) : ?>
<form class="plugin-filtering-widget filtering-form">
    <ul>
    <?php if (!empty($this->tags)) : ?>
        <li>
            <p class="filter-header"><?php echo $this->translate('Category'); ?></p>
            <ul>
            <?php foreach ($this->tags as $tag) :?>
                <li>
                    <label>
                        <input type="checkbox"
                               name="category"
                               value="<?php echo $tag['name']; ?>"
                               <?php if ($tag['checked']) echo 'checked'; ?>
                            />
                        <a href="<?php echo $this->url().'?category='.urlencode($tag['name']); ?>"><?php echo $tag['name']; ?></a></label>
                </li>
            <?php endforeach; ?>
            </ul>
        </li>
    <?php endif; ?>
    <?php if (!empty($this->brands)) : ?>
        <li>
            <p class="filter-header"><?php echo $this->translate('Brand'); ?></p>
            <ul>
            <?php foreach ($this->brands as $brand) :?>
                <li>
                    <label>
                        <input type="checkbox"
                               name="brand"
                               value="<?php echo $brand['name']; ?>"
                               <?php if ($brand['checked']) echo 'checked'; ?>
                            />
                        <a href="<?php echo $this->url().'?brand='.urlencode($brand['name']); ?>"><?php echo $brand['name']; ?></a></label>
                </li>
            <?php endforeach; ?>
            </ul>
        </li>
    <?php endif; ?>
    <?php if ($this->priceRange) : ?>
        <li class="filter-price">
            <p class="filter-header"><?php echo $this->translate('Price'); ?></p>
            <?php echo $this->partial('_range-slider.phtml', $this->priceRange); ?>
        </li>
    <?php endif; ?>
    <?php foreach ($this->filters as $filter) : ?>
        <li>
            <p class="filter-header"><?php echo $filter['label']; ?></p>
        <?php if ($filter['type'] === 'range') : ?>
            <?php echo $this->partial('_range-slider.phtml', $filter); ?>
        <?php else : ?>
            <ul>
                <?php
                foreach ($filter['value'] as $value) : ?>
                    <?php $checked = in_array($value, $filter['checked']); ?>
                    <li>
                        <label>
                            <input type="checkbox"
                                   name="<?php echo $filter['name']; ?>"
                                   value="<?php echo $value; ?>"
                                   <?php if ($checked) { echo 'checked'; }; ?>
                                />
                            <a href="<?php echo $this->url().'?'.$filter['name'].'='.urlencode($value); ?>"><?php echo $value; ?></a></label>
                    </li>
                <?php endforeach; ?>
            </ul>
        <?php endif; ?>
        </li>
    <?php endforeach; ?>
    </ul>
    <button><?php echo $this->translate('Apply filters');?></button>
</form>
<?php if ($this->priceRange) :?>
<script>
    $(function () {
        <?php if (empty($this->priceSlider)) : ?>
        $(".price-field").on('change', function(){
           $('input[name=price]').val(''+parseFloat($(".price-min").val())+'-'+ parseFloat($(".price-max").val()));
        });
        <?php endif; ?>
        $('div.price-slider, .filter-slider').each(function () {
            var self = this,
                data = $(self).data();
            $(this).slider({
                range: true,
                min: parseFloat(data.min),
                max: parseFloat(data.max),
                values: [ parseFloat(data.from || data.min), parseFloat(data.to || data.max) ],
                slide: function( event, ui ) {
                    var $wrapper = $(self).closest('li');
                    if ($wrapper.length) {
                        $('span.filter-from', $wrapper).text(ui.values[0]);
                        $('span.filter-to', $wrapper).text(ui.values[1]);
                        $('input.filter-value', $wrapper).val( ui.values[0] + '-' + ui.values[1] );
                    }
                }
            });
        });
    });
</script>
<?php endif; ?>
<?php endif; ?>
